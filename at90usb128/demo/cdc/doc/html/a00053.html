<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Atmel: usb_task.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>usb_task.c File Reference</h1>,vThis file manages the USB task either device/host or both. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="a00096.html">config.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="a00095.html">conf_usb.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="a00129.html">usb_task.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="a00121.html">lib_mcu/usb/usb_drv.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="a00117.html">usb_descriptors.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="a00102.html">lib_mcu/power/power_drv.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="a00130.html">lib_mcu/wdt/wdt_drv.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="a00100.html">lib_mcu/pll/pll_drv.h</a>&quot;</code><br>
<code>#include &quot;modules/usb/host_chap9/usb_host_task.h&quot;</code><br>
<code>#include &quot;<a class="el" href="a00119.html">modules/usb/device_chap9/usb_device_task.h</a>&quot;</code><br>

<p>
Include dependency graph for usb_task.c:<p><center><img src="a00173.png" border="0" usemap="#usb_task.c_map" alt=""></center>
<map name="usb_task.c_map">
<area href="a00020.html" shape="rect" coords="497,60,567,87" alt="">
<area href="a00019.html" shape="rect" coords="488,162,576,188" alt="">
<area href="a00054.html" shape="rect" coords="248,136,333,163" alt="">
<area href="a00046.html" shape="rect" coords="213,187,368,214" alt="">
<area href="a00042.html" shape="rect" coords="227,86,355,112" alt="">
<area href="a00026.html" shape="rect" coords="199,288,383,315" alt="">
<area href="a00055.html" shape="rect" coords="213,339,368,366" alt="">
<area href="a00024.html" shape="rect" coords="221,390,360,416" alt="">
<area href="a00044.html" shape="rect" coords="143,491,439,518" alt="">
</map>

<p>
<a href="a00128.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00053.html#d7ea8bb36a7821aa7bc5fb35a0e4eefa">LOG_STR_CODE</a>(str)</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00087.html#g3f12a1a1edad96df977ce6cf9cc2e334">usb_task_init</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function initializes the USB proces.  <a href="a00087.html#g3f12a1a1edad96df977ce6cf9cc2e334"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00087.html#gcfc13a32887382f69c46749dad1afa45">usb_task</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Entry point of the USB mamnagement.  <a href="a00087.html#gcfc13a32887382f69c46749dad1afa45"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">__interrupt void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00053.html#7ad5d72f4941eeb9b19fe64ef375dd71">usb_general_interrupt</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">USB interrupt subroutine.  <a href="#7ad5d72f4941eeb9b19fe64ef375dd71"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00061.html#g7d453cb18055e3b9daa81e267336bc2d">suspend_action</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00059.html#g78fd22efd786f0871b196eb1f2d59bcc">host_suspend_action</a> (void)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00017.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00053.html#fdb7b63c1c8324af4cb42754a0076c85">g_sav_int_sof_enable</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">volatile <a class="el" href="a00017.html#df928e51a60dba0df29d615401cc55a8">U16</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00087.html#g7ac443ad2b3af51ce54d49d689acce3b">g_usb_event</a> = 0</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Public : U16 g_usb_event usb_connected is used to store USB events detected upon USB general interrupt subroutine Its value is managed by the following macros (See <a class="el" href="a00030.html#ed5dc15ac85ff3c7d7fa42347be906da">usb_task.h</a> file) <a class="el" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event(x)</a> <a class="el" href="a00088.html#g41da8b1e05449acf720091b1cab8cb3f">Usb_ack_event(x)</a> <a class="el" href="a00088.html#gbd7e6a26ac11daf279b07563e3b6dc11">Usb_clear_all_event()</a> <a class="el" href="a00088.html#g7c9320480ef6ad04fa7ecc5fbe46794d">Is_usb_event(x)</a> <a class="el" href="a00088.html#g3da7d8904c82c9c2e4e8cd9f1bdb54e0">Is_not_usb_event(x)</a>.  <a href="a00087.html#g7ac443ad2b3af51ce54d49d689acce3b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bit&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00053.html#23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Public : (bit) usb_connected usb_connected is set to TRUE when VBUS has been detected usb_connected is set to FALSE otherwise Used with USB_DEVICE_FEATURE == ENABLED only /.  <a href="#23b6941338ed6040e65fe3deb2bc3cf4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00017.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00086.html#g17e7aa663c771d6bddfea612365b55ee">usb_configuration_nb</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Public : (U8) usb_configuration_nb Store the number of the USB configuration used by the USB device when its value is different from zero, it means the device mode is enumerated Used with USB_DEVICE_FEATURE == ENABLED only /.  <a href="a00086.html#g17e7aa663c771d6bddfea612365b55ee"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">volatile <a class="el" href="a00017.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00087.html#g0c2e3155e09f806dabe53eb565747313">private_sof_counter</a> = 0</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Private : (U8) private_sof_counter Incremented by host SOF interrupt subroutime This counter is used to detect timeout in host requests.  <a href="a00087.html#g0c2e3155e09f806dabe53eb565747313"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">volatile S_pipe_int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00053.html#3affb22f576383543c89933f3ec68ba0">it_pipe_str</a> [MAX_EP_NB]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00017.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00087.html#g15f9a9a8d1f9d6e6f4004f586453fc4d">g_usb_mode</a> = 0x00</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Public : (U8) g_usb_mode Used in dual role application (both device/host) to store the current mode the usb controller is operating /.  <a href="a00087.html#g15f9a9a8d1f9d6e6f4004f586453fc4d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00017.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00053.html#20e543a0bffedb59ae305d29610cd6ec">g_old_usb_mode</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
,vThis file manages the USB task either device/host or both. 
<p>
Copyright (c) 2006 Atmel.<p>
Please read file license.txt for copyright notice.<p>
The USB task selects the correct USB task (usb_device task or usb_host task to be executed depending on the current mode available.<p>
According to USB_DEVICE_FEATURE and USB_HOST_FEATURE value (located in <a class="el" href="a00030.html#ed5dc15ac85ff3c7d7fa42347be906da">conf_usb.h</a> file) The usb_task can be configured to support USB DEVICE mode or USB Host mode or both for a dual role device application.<p>
This module also contains the general USB interrupt subroutine. This subroutine is used to detect asynchronous USB events.<p>
Note:<ul>
<li>The usb_task belongs to the scheduler, the usb_device_task and usb_host do not, they are called from the general usb_task</li><li>See <a class="el" href="a00030.html#ed5dc15ac85ff3c7d7fa42347be906da">conf_usb.h</a> file for more details about the configuration of this module</li></ul>
<p>
<dl class="version" compact><dt><b>Version:</b></dt><dd>1.28 at90usb128-demo-cdc-1_0_3 <dl class="rcs" compact><dt><b>Id</b></dt><dd><a class="el" href="a00053.html">usb_task.c</a>,v 1.28 2006/07/03 11:55:11 rletendu Exp </dd></dl>
</dd></dl>
<dl compact><dt><b><a class="el" href="todo.html#_todo000023">Todo:</a></b></dt><dd></dd></dl>
<dl compact><dt><b><a class="el" href="bug.html#_bug000021">Bug:</a></b></dt><dd>/ </dd></dl>

<p>
Definition in file <a class="el" href="a00128.html">usb_task.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="d7ea8bb36a7821aa7bc5fb35a0e4eefa"></a><!-- doxytag: member="usb_task.c::LOG_STR_CODE" ref="d7ea8bb36a7821aa7bc5fb35a0e4eefa" args="(str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG_STR_CODE          </td>
          <td>(</td>
          <td class="paramtype">str&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00128.html#l00063">63</a> of file <a class="el" href="a00128.html">usb_task.c</a>.
<p>
Referenced by <a class="el" href="a00128.html#l00286">usb_general_interrupt()</a>, and <a class="el" href="a00128.html#l00199">usb_task()</a>.
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="7ad5d72f4941eeb9b19fe64ef375dd71"></a><!-- doxytag: member="usb_task.c::usb_general_interrupt" ref="7ad5d72f4941eeb9b19fe64ef375dd71" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__interrupt void usb_general_interrupt           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
USB interrupt subroutine. 
<p>
This function is called each time a USB interrupt occurs. The following USB DEVICE events are taken in charge:<ul>
<li>VBus On / Off</li><li>Start Of Frame</li><li>Suspend</li><li>Wake-Up</li><li>Resume</li><li>Reset</li><li>Start of frame</li></ul>
<p>
The following USB HOST events are taken in charge:<ul>
<li>Device connection</li><li>Device Disconnection</li><li>Start Of Frame</li><li>ID pin change</li><li>SOF (or Keep alive in low speed) sent</li><li>Wake up on USB line detected</li></ul>
<p>
For each event, the user can launch an action by completing the associate define (See <a class="el" href="a00030.html#ed5dc15ac85ff3c7d7fa42347be906da">conf_usb.h</a> file to add action upon events)<p>
Note: Only interrupts events that are enabled are processed<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>none </dd></dl>

<p>
Definition at line <a class="el" href="a00128.html#l00286">286</a> of file <a class="el" href="a00128.html">usb_task.c</a>.
<p>
References <a class="el" href="a00093.html#l00225">DISABLE</a>, <a class="el" href="a00093.html#l00222">ENABLE</a>, <a class="el" href="a00129.html#l00049">EVT_HOST_DISCONNECTION</a>, <a class="el" href="a00129.html#l00048">EVT_HOST_HWUP</a>, <a class="el" href="a00129.html#l00047">EVT_HOST_SOF</a>, <a class="el" href="a00129.html#l00041">EVT_USB_DEVICE_FUNCTION</a>, <a class="el" href="a00129.html#l00042">EVT_USB_HOST_FUNCTION</a>, <a class="el" href="a00129.html#l00039">EVT_USB_POWERED</a>, <a class="el" href="a00129.html#l00046">EVT_USB_RESET</a>, <a class="el" href="a00129.html#l00045">EVT_USB_RESUME</a>, <a class="el" href="a00129.html#l00043">EVT_USB_SUSPEND</a>, <a class="el" href="a00129.html#l00040">EVT_USB_UNPOWERED</a>, <a class="el" href="a00129.html#l00044">EVT_USB_WAKE_UP</a>, <a class="el" href="a00093.html#l00226">FALSE</a>, <a class="el" href="a00128.html#l00125">g_old_usb_mode</a>, <a class="el" href="a00053.html#fdb7b63c1c8324af4cb42754a0076c85">g_sav_int_sof_enable</a>, <a class="el" href="a00128.html#l00124">g_usb_mode</a>, <a class="el" href="a00121.html#l00651">Host_ack_device_connection</a>, <a class="el" href="a00121.html#l00661">Host_ack_device_disconnection</a>, <a class="el" href="a00121.html#l00621">Host_ack_hwup</a>, <a class="el" href="a00121.html#l00610">Host_ack_sof</a>, <a class="el" href="a00095.html#l00129">Host_device_connection_action</a>, <a class="el" href="a00095.html#l00128">Host_device_disconnection_action</a>, <a class="el" href="a00120.html#l00264">host_disable_all_pipe()</a>, <a class="el" href="a00121.html#l00615">Host_disable_hwup_interrupt</a>, <a class="el" href="a00121.html#l00605">Host_disable_sof_interrupt</a>, <a class="el" href="a00121.html#l00814">Host_get_pipe_type</a>, <a class="el" href="a00121.html#l00694">Host_get_selected_pipe</a>, <a class="el" href="a00095.html#l00132">Host_hwup_action</a>, <a class="el" href="a00121.html#l00691">Host_select_pipe</a>, <a class="el" href="a00095.html#l00130">Host_sof_action</a>, <a class="el" href="a00121.html#l00649">Is_device_connection</a>, <a class="el" href="a00121.html#l00659">Is_device_disconnection</a>, <a class="el" href="a00121.html#l00647">Is_host_device_connection_interrupt_enabled</a>, <a class="el" href="a00121.html#l00657">Is_host_device_disconnection_interrupt_enabled</a>, <a class="el" href="a00121.html#l00620">Is_host_hwup</a>, <a class="el" href="a00121.html#l00616">Is_host_hwup_interrupt_enabled</a>, <a class="el" href="a00121.html#l00609">Is_host_sof</a>, <a class="el" href="a00121.html#l00606">Is_host_sof_interrupt_enabled</a>, <a class="el" href="a00121.html#l00380">Is_reset_interrupt_enabled</a>, <a class="el" href="a00121.html#l00360">Is_resume_interrupt_enabled</a>, <a class="el" href="a00121.html#l00390">Is_sof_interrupt_enabled</a>, <a class="el" href="a00121.html#l00400">Is_suspend_interrupt_enabled</a>, <a class="el" href="a00121.html#l00370">Is_swake_up_interrupt_enabled</a>, <a class="el" href="a00121.html#l00201">Is_usb_id_device</a>, <a class="el" href="a00121.html#l00200">Is_usb_id_interrupt_enabled</a>, <a class="el" href="a00121.html#l00203">Is_usb_id_transition</a>, <a class="el" href="a00121.html#l00384">Is_usb_reset</a>, <a class="el" href="a00121.html#l00364">Is_usb_resume</a>, <a class="el" href="a00121.html#l00394">Is_usb_sof</a>, <a class="el" href="a00121.html#l00404">Is_usb_suspend</a>, <a class="el" href="a00121.html#l00208">Is_usb_vbus_high</a>, <a class="el" href="a00121.html#l00207">Is_usb_vbus_interrupt_enabled</a>, <a class="el" href="a00121.html#l00211">Is_usb_vbus_transition</a>, <a class="el" href="a00121.html#l00374">Is_usb_wake_up</a>, <a class="el" href="a00053.html#3affb22f576383543c89933f3ec68ba0">it_pipe_str</a>, <a class="el" href="a00128.html#l00063">LOG_STR_CODE</a>, <a class="el" href="a00121.html#l00030">MAX_EP_NB</a>, <a class="el" href="a00128.html#l00110">private_sof_counter</a>, <a class="el" href="a00093.html#l00227">TRUE</a>, <a class="el" href="a00121.html#l00095">TYPE_INTERRUPT</a>, <a class="el" href="a00121.html#l00202">Usb_ack_id_transition</a>, <a class="el" href="a00121.html#l00382">Usb_ack_reset</a>, <a class="el" href="a00121.html#l00362">Usb_ack_resume</a>, <a class="el" href="a00121.html#l00392">Usb_ack_sof</a>, <a class="el" href="a00121.html#l00402">Usb_ack_suspend</a>, <a class="el" href="a00121.html#l00210">Usb_ack_vbus_transition</a>, <a class="el" href="a00121.html#l00372">Usb_ack_wake_up</a>, <a class="el" href="a00121.html#l00335">Usb_attach</a>, <a class="el" href="a00126.html#l00070">usb_configuration_nb</a>, <a class="el" href="a00118.html#l00046">usb_connected</a>, <a class="el" href="a00121.html#l00359">Usb_disable_resume_interrupt</a>, <a class="el" href="a00121.html#l00369">Usb_disable_wake_up_interrupt</a>, <a class="el" href="a00121.html#l00377">Usb_enable_reset_interrupt</a>, <a class="el" href="a00121.html#l00367">Usb_enable_wake_up_interrupt</a>, <a class="el" href="a00121.html#l00194">Usb_freeze_clock</a>, <a class="el" href="a00095.html#l00127">Usb_id_transition_action</a>, <a class="el" href="a00120.html#l00183">usb_init_device()</a>, <a class="el" href="a00129.html#l00108">USB_MODE_DEVICE</a>, <a class="el" href="a00129.html#l00107">USB_MODE_HOST</a>, <a class="el" href="a00095.html#l00165">Usb_reset_action</a>, <a class="el" href="a00095.html#l00163">Usb_resume_action</a>, <a class="el" href="a00129.html#l00030">Usb_send_event</a>, <a class="el" href="a00095.html#l00161">Usb_sof_action</a>, <a class="el" href="a00118.html#l00100">usb_start_device()</a>, <a class="el" href="a00095.html#l00164">Usb_suspend_action</a>, <a class="el" href="a00121.html#l00195">Usb_unfreeze_clock</a>, <a class="el" href="a00095.html#l00167">Usb_vbus_off_action</a>, <a class="el" href="a00095.html#l00166">Usb_vbus_on_action</a>, <a class="el" href="a00095.html#l00162">Usb_wake_up_action</a>, <a class="el" href="a00100.html#l00049">Wait_pll_ready</a>, <a class="el" href="a00130.html#l00107">Wdt_change_16ms</a>, and <a class="el" href="a00130.html#l00048">Wdt_change_enable</a>.<div class="fragment"><pre class="fragment"><a name="l00288"></a>00288 {
<a name="l00289"></a>00289 <span class="preprocessor">   #if (USB_HOST_PIPE_INTERRUPT_TRANSFER == ENABLE)</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>   <a class="code" href="a00017.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> i;
<a name="l00291"></a>00291    <a class="code" href="a00017.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> save_pipe_nb;
<a name="l00292"></a>00292 <span class="preprocessor">   #endif</span>
<a name="l00293"></a>00293 <span class="preprocessor"></span><span class="comment">// ---------- DEVICE events management -----------------------------------</span>
<a name="l00294"></a>00294 <span class="preprocessor">#if (USB_DEVICE_FEATURE == ENABLED)</span>
<a name="l00295"></a>00295 <span class="preprocessor"></span>  <span class="comment">//- VBUS state detection</span>
<a name="l00296"></a>00296    <span class="keywordflow">if</span> (<a class="code" href="a00080.html#g4e9bee9ab528178c8c41ffa12e4e32c4">Is_usb_vbus_transition</a>() &amp;&amp; <a class="code" href="a00080.html#g7bd1ed5ac81c3773610abfbc2608e0c1">Is_usb_vbus_interrupt_enabled</a>())
<a name="l00297"></a>00297    {
<a name="l00298"></a>00298       <a class="code" href="a00080.html#g6a534b44343c4108dbcd68d2fef8b5e6">Usb_ack_vbus_transition</a>();
<a name="l00299"></a>00299       <span class="keywordflow">if</span> (<a class="code" href="a00080.html#gf579eb0fe6dd1bf96e18b70399a52990">Is_usb_vbus_high</a>())
<a name="l00300"></a>00300       {
<a name="l00301"></a>00301          <a class="code" href="a00043.html#23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a> = <a class="code" href="a00017.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00302"></a>00302          <a class="code" href="a00062.html#g14458cb2f309214b7263228a2a3dea9d">Usb_vbus_on_action</a>();
<a name="l00303"></a>00303          <a class="code" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event</a>(<a class="code" href="a00088.html#g8e65027bd2630b342ef2a678001ea830">EVT_USB_POWERED</a>);
<a name="l00304"></a>00304          <a class="code" href="a00081.html#gb1785329acf114fd5f1e2c88d7d0f1c2">Usb_enable_reset_interrupt</a>();
<a name="l00305"></a>00305          <a class="code" href="a00085.html#g3384a2b4d7c3cf2702b11ec8aaa39223">usb_start_device</a>();
<a name="l00306"></a>00306          <a class="code" href="a00081.html#g8b4883ed7eb31838167ff67c74a20647">Usb_attach</a>();
<a name="l00307"></a>00307       }
<a name="l00308"></a>00308       <span class="keywordflow">else</span>
<a name="l00309"></a>00309       {
<a name="l00310"></a>00310          <a class="code" href="a00062.html#gc40ad51a1af2bac210c3cbe842b6c9f5">Usb_vbus_off_action</a>();
<a name="l00311"></a>00311          <a class="code" href="a00043.html#23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a> = <a class="code" href="a00017.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00312"></a>00312          <a class="code" href="a00043.html#17e7aa663c771d6bddfea612365b55ee">usb_configuration_nb</a> = 0;
<a name="l00313"></a>00313          <a class="code" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event</a>(<a class="code" href="a00088.html#g2300aefd46bdb777fc0db3276e112755">EVT_USB_UNPOWERED</a>);
<a name="l00314"></a>00314       }
<a name="l00315"></a>00315    }
<a name="l00316"></a>00316   <span class="comment">// - Device start of frame received</span>
<a name="l00317"></a>00317    <span class="keywordflow">if</span> (<a class="code" href="a00081.html#g393d984c1832de52115a0302830dc7c9">Is_usb_sof</a>() &amp;&amp; <a class="code" href="a00081.html#gc0aa525bef1a9cd2a20e908f5738588a">Is_sof_interrupt_enabled</a>())
<a name="l00318"></a>00318    {
<a name="l00319"></a>00319       <a class="code" href="a00081.html#gc4b8701cc674e1a5585ed336777efd08">Usb_ack_sof</a>();
<a name="l00320"></a>00320       <a class="code" href="a00062.html#g001e2ac8b87be66d9917e330f85c8e44">Usb_sof_action</a>();
<a name="l00321"></a>00321    }
<a name="l00322"></a>00322   <span class="comment">// - Device Suspend event (no more USB activity detected)</span>
<a name="l00323"></a>00323    <span class="keywordflow">if</span> (<a class="code" href="a00081.html#gc1f5abeba55a0a6ca3baefc565c958e4">Is_usb_suspend</a>() &amp;&amp; <a class="code" href="a00081.html#g5c99aed51fbf69924d482a95354a5577">Is_suspend_interrupt_enabled</a>())
<a name="l00324"></a>00324    {
<a name="l00325"></a>00325       <a class="code" href="a00081.html#ga4199298d2a06fbe076c0f66a70a714a">Usb_ack_suspend</a>();
<a name="l00326"></a>00326       <a class="code" href="a00081.html#g688e0d7f5b979c77c641e14e162f4bb3">Usb_enable_wake_up_interrupt</a>();
<a name="l00327"></a>00327       <a class="code" href="a00081.html#gf6d8940d14202ca46838a178068fc83f">Usb_ack_wake_up</a>();                 <span class="comment">// clear wake up to detect next event</span>
<a name="l00328"></a>00328       <a class="code" href="a00080.html#g84bc0b49ddb8e6cb499d6f4c9bb3eef3">Usb_freeze_clock</a>();
<a name="l00329"></a>00329       <a class="code" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event</a>(<a class="code" href="a00088.html#gc3606e159ecd42741cba511a4a576f9f">EVT_USB_SUSPEND</a>);
<a name="l00330"></a>00330       <a class="code" href="a00062.html#gfd449fcf4a93026cf00f5d4c64685ca3">Usb_suspend_action</a>();
<a name="l00331"></a>00331    }
<a name="l00332"></a>00332   <span class="comment">// - Wake up event (USB activity detected): Used to resume</span>
<a name="l00333"></a>00333    <span class="keywordflow">if</span> (<a class="code" href="a00081.html#g9551f9baf5238c42ac318ea54f508517">Is_usb_wake_up</a>() &amp;&amp; <a class="code" href="a00081.html#gc602a6279cebea3644bce2fe4fd8356f">Is_swake_up_interrupt_enabled</a>())
<a name="l00334"></a>00334    {
<a name="l00335"></a>00335       <a class="code" href="a00080.html#g8bf7d660725edf11bc4c59baae4b2090">Usb_unfreeze_clock</a>();
<a name="l00336"></a>00336       <a class="code" href="a00081.html#gf6d8940d14202ca46838a178068fc83f">Usb_ack_wake_up</a>();
<a name="l00337"></a>00337       <a class="code" href="a00081.html#g8cbfa4fad6d126cb9547be30cf029be5">Usb_disable_wake_up_interrupt</a>();
<a name="l00338"></a>00338       <a class="code" href="a00062.html#g702faf374e8fa6f66a3b7b8efd990c54">Usb_wake_up_action</a>();
<a name="l00339"></a>00339       <a class="code" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event</a>(<a class="code" href="a00088.html#g0de9d7b1d1f4567d83961a86d46a7874">EVT_USB_WAKE_UP</a>);
<a name="l00340"></a>00340    }
<a name="l00341"></a>00341   <span class="comment">// - Resume state bus detection</span>
<a name="l00342"></a>00342    <span class="keywordflow">if</span> (<a class="code" href="a00081.html#g0e093a377aa64273d11c072c2faa0fe2">Is_usb_resume</a>() &amp;&amp; <a class="code" href="a00081.html#g029e6c1d8842de6654c7bbecabc80261">Is_resume_interrupt_enabled</a>())
<a name="l00343"></a>00343    {
<a name="l00344"></a>00344       <a class="code" href="a00081.html#g8cbfa4fad6d126cb9547be30cf029be5">Usb_disable_wake_up_interrupt</a>();
<a name="l00345"></a>00345       <a class="code" href="a00081.html#gaefd94877801d219f7c382e3a9c6f5f5">Usb_ack_resume</a>();
<a name="l00346"></a>00346       <a class="code" href="a00081.html#gd798460b713d401890e35b41fcdc0afb">Usb_disable_resume_interrupt</a>();
<a name="l00347"></a>00347       <a class="code" href="a00062.html#gb89c65a65f7cdd8798357226751d2107">Usb_resume_action</a>();
<a name="l00348"></a>00348       <a class="code" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event</a>(<a class="code" href="a00088.html#g2eadc81bd70b67f3dd11084449091d2f">EVT_USB_RESUME</a>);
<a name="l00349"></a>00349    }
<a name="l00350"></a>00350   <span class="comment">// - USB bus reset detection</span>
<a name="l00351"></a>00351    <span class="keywordflow">if</span> (<a class="code" href="a00081.html#g6733e9c27679746b94e64c1c6192b285">Is_usb_reset</a>()&amp;&amp; <a class="code" href="a00081.html#gb4c08fc8c764e428cf0cf814a79775e8">Is_reset_interrupt_enabled</a>())
<a name="l00352"></a>00352    {
<a name="l00353"></a>00353       <a class="code" href="a00081.html#gb8cd48102c081151d752c21f8ca7ac74">Usb_ack_reset</a>();
<a name="l00354"></a>00354       <a class="code" href="a00045.html#f03d76cb0a6201b1c1de6bc25bf6657e">usb_init_device</a>();
<a name="l00355"></a>00355       <a class="code" href="a00062.html#g153bd0949cfe508cd7c8e9e803d7b059">Usb_reset_action</a>();
<a name="l00356"></a>00356       <a class="code" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event</a>(<a class="code" href="a00088.html#gc28579335a8f21ae1dcef6d69fbb1359">EVT_USB_RESET</a>);
<a name="l00357"></a>00357    }
<a name="l00358"></a>00358 <span class="preprocessor">#endif// End DEVICE FEATURE MODE</span>
<a name="l00359"></a>00359 <span class="preprocessor"></span>
<a name="l00360"></a>00360 <span class="comment">// ---------- HOST events management -----------------------------------</span>
<a name="l00361"></a>00361 <span class="preprocessor">#if (USB_HOST_FEATURE == ENABLED &amp;&amp; USB_DEVICE_FEATURE == ENABLED)</span>
<a name="l00362"></a>00362 <span class="preprocessor"></span>  <span class="comment">// - ID pin change detection</span>
<a name="l00363"></a>00363    <span class="keywordflow">if</span>(<a class="code" href="a00080.html#g345584831c43412fde0d066b750eb4ec">Is_usb_id_transition</a>()&amp;&amp;<a class="code" href="a00080.html#g941437b95820426950e5111b82d09814">Is_usb_id_interrupt_enabled</a>())
<a name="l00364"></a>00364    {
<a name="l00365"></a>00365       <span class="keywordflow">if</span>(<a class="code" href="a00080.html#g66dda64b995b495f54ef99774abb67d1">Is_usb_id_device</a>())
<a name="l00366"></a>00366       { <a class="code" href="a00087.html#g15f9a9a8d1f9d6e6f4004f586453fc4d">g_usb_mode</a>=<a class="code" href="a00087.html#g673fc2cbe441f3f8e252171b9548cfd3">USB_MODE_DEVICE</a>;}
<a name="l00367"></a>00367       <span class="keywordflow">else</span>
<a name="l00368"></a>00368       { <a class="code" href="a00087.html#g15f9a9a8d1f9d6e6f4004f586453fc4d">g_usb_mode</a>=<a class="code" href="a00087.html#g0322da46e441ec8a861ae3eb2cec9bf0">USB_MODE_HOST</a>;}
<a name="l00369"></a>00369       <a class="code" href="a00080.html#g6be23915ef352233cba6ae031b5f2347">Usb_ack_id_transition</a>();
<a name="l00370"></a>00370       <span class="keywordflow">if</span>( <a class="code" href="a00087.html#g15f9a9a8d1f9d6e6f4004f586453fc4d">g_usb_mode</a> != <a class="code" href="a00053.html#20e543a0bffedb59ae305d29610cd6ec">g_old_usb_mode</a>) <span class="comment">// Basic Debounce</span>
<a name="l00371"></a>00371       {
<a name="l00372"></a>00372          <span class="keywordflow">if</span>(<a class="code" href="a00080.html#g66dda64b995b495f54ef99774abb67d1">Is_usb_id_device</a>()) <span class="comment">// Going to device mode</span>
<a name="l00373"></a>00373          {
<a name="l00374"></a>00374             <a class="code" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event</a>(<a class="code" href="a00088.html#g8baa3aa4dc2518c32830ba6a92a77360">EVT_USB_DEVICE_FUNCTION</a>);
<a name="l00375"></a>00375          }
<a name="l00376"></a>00376          <span class="keywordflow">else</span>                   <span class="comment">// Going to host mode</span>
<a name="l00377"></a>00377          {
<a name="l00378"></a>00378             <a class="code" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event</a>(<a class="code" href="a00088.html#g433df0f6e4ef196cddc7a82f47877667">EVT_USB_HOST_FUNCTION</a>);
<a name="l00379"></a>00379          }
<a name="l00380"></a>00380          <a class="code" href="a00060.html#gd70a788b44e96f4d3ba7cc2adc570ca7">Usb_id_transition_action</a>();
<a name="l00381"></a>00381          <a class="code" href="a00053.html#d7ea8bb36a7821aa7bc5fb35a0e4eefa">LOG_STR_CODE</a>(log_id_change);
<a name="l00382"></a>00382 <span class="preprocessor">         #if ( ID_PIN_CHANGE_GENERATE_RESET == ENABLE)</span>
<a name="l00383"></a>00383 <span class="preprocessor"></span>        <span class="comment">// Hot ID transition generates wdt reset</span>
<a name="l00384"></a>00384 <span class="preprocessor">            #ifndef  AVRGCC</span>
<a name="l00385"></a>00385 <span class="preprocessor"></span>               <a class="code" href="a00090.html#g12cbe3ec166119c8dd2adcec42525bba">Wdt_change_16ms</a>(); <span class="keywordflow">while</span>(1);
<a name="l00386"></a>00386 <span class="preprocessor">            #else</span>
<a name="l00387"></a>00387 <span class="preprocessor"></span>               <a class="code" href="a00090.html#ga9653a998d010f51c187657434e47b8a">Wdt_change_enable</a>(); <span class="keywordflow">while</span>(1);
<a name="l00388"></a>00388 <span class="preprocessor">            #endif</span>
<a name="l00389"></a>00389 <span class="preprocessor"></span><span class="preprocessor">         #endif</span>
<a name="l00390"></a>00390 <span class="preprocessor"></span>      }
<a name="l00391"></a>00391    }
<a name="l00392"></a>00392 <span class="preprocessor">#endif</span>
<a name="l00393"></a>00393 <span class="preprocessor"></span><span class="preprocessor">#if (USB_HOST_FEATURE == ENABLED)</span>
<a name="l00394"></a>00394 <span class="preprocessor"></span>  <span class="comment">// - The device has been disconnected</span>
<a name="l00395"></a>00395    <span class="keywordflow">if</span>(<a class="code" href="a00083.html#g8df8b83d2b75b1aaae38ea2c569501ba">Is_device_disconnection</a>() &amp;&amp; <a class="code" href="a00083.html#g448daf6aa9c6a8e28f3ec37050198ab6">Is_host_device_disconnection_interrupt_enabled</a>())
<a name="l00396"></a>00396    {
<a name="l00397"></a>00397       <a class="code" href="a00045.html#c68776f00e504f290d0e004afdd24cbb">host_disable_all_pipe</a>();
<a name="l00398"></a>00398       <a class="code" href="a00083.html#gf0b70dd65f6cc98b9eead116e9087efc">Host_ack_device_disconnection</a>();
<a name="l00399"></a>00399       device_state=DEVICE_DISCONNECTED;
<a name="l00400"></a>00400       <a class="code" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event</a>(<a class="code" href="a00088.html#gf519b5bb88574351405a4ee0d3c594f4">EVT_HOST_DISCONNECTION</a>);
<a name="l00401"></a>00401       <a class="code" href="a00053.html#d7ea8bb36a7821aa7bc5fb35a0e4eefa">LOG_STR_CODE</a>(log_device_disconnect);
<a name="l00402"></a>00402       <a class="code" href="a00060.html#g3e0d8fbdcc95a0855b172f773be71ed4">Host_device_disconnection_action</a>();
<a name="l00403"></a>00403    }
<a name="l00404"></a>00404   <span class="comment">// - Device connection</span>
<a name="l00405"></a>00405    <span class="keywordflow">if</span>(<a class="code" href="a00083.html#gd2a979c90dd4fc17c961978050c0bb8e">Is_device_connection</a>() &amp;&amp; <a class="code" href="a00083.html#gb9469204f497054f7cd35557d2d49854">Is_host_device_connection_interrupt_enabled</a>())
<a name="l00406"></a>00406    {
<a name="l00407"></a>00407       <a class="code" href="a00083.html#gd5a6ef0b26211dddcaebe99f6cfc9b3a">Host_ack_device_connection</a>();
<a name="l00408"></a>00408       <a class="code" href="a00045.html#c68776f00e504f290d0e004afdd24cbb">host_disable_all_pipe</a>();
<a name="l00409"></a>00409       <a class="code" href="a00060.html#g9114c6bf6c284f1fb22a3160de79ea32">Host_device_connection_action</a>();
<a name="l00410"></a>00410    }
<a name="l00411"></a>00411   <span class="comment">// - Host Start of frame has been sent</span>
<a name="l00412"></a>00412    <span class="keywordflow">if</span> (<a class="code" href="a00083.html#g5feefe8fe7176fe15bcfbc29f4f2f48a">Is_host_sof</a>() &amp;&amp; <a class="code" href="a00083.html#gd9ea64840c5a27fe482dfd16d228fa0b">Is_host_sof_interrupt_enabled</a>())
<a name="l00413"></a>00413    {
<a name="l00414"></a>00414       <a class="code" href="a00083.html#g7d27765db2691591fdc49e938637b9af">Host_ack_sof</a>();
<a name="l00415"></a>00415       <a class="code" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event</a>(<a class="code" href="a00088.html#gcfb019547665d9f082d732c37f4054ea">EVT_HOST_SOF</a>);
<a name="l00416"></a>00416       <a class="code" href="a00087.html#g0c2e3155e09f806dabe53eb565747313">private_sof_counter</a>++;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418       <span class="comment">// delay timeout management for interrupt tranfer mode in host mode</span>
<a name="l00419"></a>00419 <span class="preprocessor">      #if ((USB_HOST_PIPE_INTERRUPT_TRANSFER==ENABLE) &amp;&amp; (TIMEOUT_DELAY_ENABLE==ENABLE))</span>
<a name="l00420"></a>00420 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="a00087.html#g0c2e3155e09f806dabe53eb565747313">private_sof_counter</a>&gt;=250)   <span class="comment">// Count 1/4 sec</span>
<a name="l00421"></a>00421       {
<a name="l00422"></a>00422          <a class="code" href="a00087.html#g0c2e3155e09f806dabe53eb565747313">private_sof_counter</a>=0;
<a name="l00423"></a>00423          <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="a00077.html#gf2735f56ebd716202bc74c3e903f2807">MAX_EP_NB</a>;i++)
<a name="l00424"></a>00424          {
<a name="l00425"></a>00425             <span class="keywordflow">if</span>(it_pipe_str[i].enable==<a class="code" href="a00017.html#514ad415fb6125ba296793df7d1a468a">ENABLE</a>)
<a name="l00426"></a>00426             {
<a name="l00427"></a>00427                save_pipe_nb=<a class="code" href="a00084.html#ga602f18f3102551a390cab51280ca702">Host_get_selected_pipe</a>();
<a name="l00428"></a>00428                <a class="code" href="a00084.html#g9cef84edfb59cc5963bebddf55f367f6">Host_select_pipe</a>(i);
<a name="l00429"></a>00429                <span class="keywordflow">if</span>((++it_pipe_str[i].timeout&gt;TIMEOUT_DELAY) &amp;&amp; (<a class="code" href="a00084.html#g907c1388c5c092356f7c6d5956a2fe9b">Host_get_pipe_type</a>()!=<a class="code" href="a00077.html#gb34d6f23ac074575b13729f4f0a418ae">TYPE_INTERRUPT</a>))
<a name="l00430"></a>00430                {
<a name="l00431"></a>00431                   <a class="code" href="a00053.html#3affb22f576383543c89933f3ec68ba0">it_pipe_str</a>[i].enable=<a class="code" href="a00017.html#99496f7308834e8b220f7894efa0b6ab">DISABLE</a>;
<a name="l00432"></a>00432                   <a class="code" href="a00053.html#3affb22f576383543c89933f3ec68ba0">it_pipe_str</a>[i].status=PIPE_DELAY_TIMEOUT;
<a name="l00433"></a>00433                   Host_stop_pipe_interrupt(i);
<a name="l00434"></a>00434                   <span class="keywordflow">if</span> (is_any_interrupt_pipe_active()==<a class="code" href="a00017.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)    <span class="comment">// If no more transfer is armed</span>
<a name="l00435"></a>00435                   {
<a name="l00436"></a>00436                      <span class="keywordflow">if</span> (g_sav_int_sof_enable==<a class="code" href="a00017.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00437"></a>00437                      {
<a name="l00438"></a>00438                         <a class="code" href="a00083.html#g42cc31cb98e8ced4cc2a3fabdd8161c6">Host_disable_sof_interrupt</a>();
<a name="l00439"></a>00439                      }
<a name="l00440"></a>00440                   }
<a name="l00441"></a>00441                   <a class="code" href="a00053.html#3affb22f576383543c89933f3ec68ba0">it_pipe_str</a>[i].handle(PIPE_DELAY_TIMEOUT,it_pipe_str[i].nb_byte_processed);
<a name="l00442"></a>00442                }
<a name="l00443"></a>00443                <a class="code" href="a00084.html#g9cef84edfb59cc5963bebddf55f367f6">Host_select_pipe</a>(save_pipe_nb);
<a name="l00444"></a>00444             }
<a name="l00445"></a>00445          }
<a name="l00446"></a>00446       }
<a name="l00447"></a>00447 <span class="preprocessor">      #endif  // (USB_HOST_PIPE_INTERRUPT_TRANSFER==ENABLE) &amp;&amp; (TIMEOUT_DELAY_ENABLE==ENABLE))</span>
<a name="l00448"></a>00448 <span class="preprocessor"></span>      <a class="code" href="a00060.html#g28489746b0296537866c7cef0dd85c06">Host_sof_action</a>();
<a name="l00449"></a>00449    }
<a name="l00450"></a>00450   <span class="comment">// - Host Wake-up has been received</span>
<a name="l00451"></a>00451    <span class="keywordflow">if</span> (<a class="code" href="a00083.html#g7b7ad6eda28daab8edfd76f8def9af5f">Is_host_hwup</a>() &amp;&amp; <a class="code" href="a00083.html#ge34c4507f47709e9875967e8d6461522">Is_host_hwup_interrupt_enabled</a>())
<a name="l00452"></a>00452    {
<a name="l00453"></a>00453       <a class="code" href="a00083.html#g31560e8573f2d9a57f4c95ce13066bc8">Host_disable_hwup_interrupt</a>();  <span class="comment">// Wake up interrupt should be disable host is now wake up !</span>
<a name="l00454"></a>00454       <span class="comment">// CAUTION HWUP can be cleared only when USB clock is active (not frozen)!</span>
<a name="l00455"></a>00455       Pll_start_auto();               <span class="comment">// First Restart the PLL for USB operation</span>
<a name="l00456"></a>00456       <a class="code" href="a00075.html#gf8afae5562a37053c7a62ddda9fbf8b1">Wait_pll_ready</a>();               <span class="comment">// Get sure pll is lock</span>
<a name="l00457"></a>00457       <a class="code" href="a00080.html#g8bf7d660725edf11bc4c59baae4b2090">Usb_unfreeze_clock</a>();           <span class="comment">// Enable clock on USB interface</span>
<a name="l00458"></a>00458       <a class="code" href="a00083.html#g228ed59251ab35193f94881e552cb2d2">Host_ack_hwup</a>();                <span class="comment">// Clear HWUP interrupt flag</span>
<a name="l00459"></a>00459       <a class="code" href="a00088.html#g5a10a90b40c67b40f448c91d8a29abd5">Usb_send_event</a>(<a class="code" href="a00088.html#g75614e4896b06236beff47947dc47d15">EVT_HOST_HWUP</a>);  <span class="comment">// Send software event</span>
<a name="l00460"></a>00460       <a class="code" href="a00060.html#gfcef7b9808ab5d3e68d1e1a0d5c130c9">Host_hwup_action</a>();             <span class="comment">// Map custom action</span>
<a name="l00461"></a>00461    }
<a name="l00462"></a>00462 <span class="preprocessor">#endif // End HOST FEATURE MODE</span>
<a name="l00463"></a>00463 <span class="preprocessor"></span>}
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="a00053_7ad5d72f4941eeb9b19fe64ef375dd71_cgraph.png" border="0" usemap="#a00053_7ad5d72f4941eeb9b19fe64ef375dd71_cgraph_map" alt=""></center>
<map name="a00053_7ad5d72f4941eeb9b19fe64ef375dd71_cgraph_map">
<area href="a00045.html#c68776f00e504f290d0e004afdd24cbb" shape="rect" coords="206,6,355,32" alt="">
<area href="a00045.html#f03d76cb0a6201b1c1de6bc25bf6657e" shape="rect" coords="404,82,516,108" alt="">
<area href="a00085.html#g3384a2b4d7c3cf2702b11ec8aaa39223" shape="rect" coords="219,107,342,134" alt="">
</map>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="fdb7b63c1c8324af4cb42754a0076c85"></a><!-- doxytag: member="usb_task.c::g_sav_int_sof_enable" ref="fdb7b63c1c8324af4cb42754a0076c85" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00017.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> <a class="el" href="a00053.html#fdb7b63c1c8324af4cb42754a0076c85">g_sav_int_sof_enable</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Referenced by <a class="el" href="a00128.html#l00286">usb_general_interrupt()</a>.
</div>
</div><p>
<a class="anchor" name="23b6941338ed6040e65fe3deb2bc3cf4"></a><!-- doxytag: member="usb_task.c::usb_connected" ref="23b6941338ed6040e65fe3deb2bc3cf4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bit <a class="el" href="a00053.html#23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Public : (bit) usb_connected usb_connected is set to TRUE when VBUS has been detected usb_connected is set to FALSE otherwise Used with USB_DEVICE_FEATURE == ENABLED only /. 
<p>

<p>
Definition at line <a class="el" href="a00118.html#l00046">46</a> of file <a class="el" href="a00118.html">usb_device_task.c</a>.
<p>
Referenced by <a class="el" href="a00118.html#l00121">usb_device_task()</a>, and <a class="el" href="a00128.html#l00286">usb_general_interrupt()</a>.
</div>
</div><p>
<a class="anchor" name="3affb22f576383543c89933f3ec68ba0"></a><!-- doxytag: member="usb_task.c::it_pipe_str" ref="3affb22f576383543c89933f3ec68ba0" args="[MAX_EP_NB]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile S_pipe_int <a class="el" href="a00053.html#3affb22f576383543c89933f3ec68ba0">it_pipe_str</a>[MAX_EP_NB]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Referenced by <a class="el" href="a00128.html#l00286">usb_general_interrupt()</a>.
</div>
</div><p>
<a class="anchor" name="20e543a0bffedb59ae305d29610cd6ec"></a><!-- doxytag: member="usb_task.c::g_old_usb_mode" ref="20e543a0bffedb59ae305d29610cd6ec" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00017.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> <a class="el" href="a00053.html#20e543a0bffedb59ae305d29610cd6ec">g_old_usb_mode</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="a00128.html#l00125">125</a> of file <a class="el" href="a00128.html">usb_task.c</a>.
<p>
Referenced by <a class="el" href="a00128.html#l00286">usb_general_interrupt()</a>, <a class="el" href="a00128.html#l00199">usb_task()</a>, and <a class="el" href="a00128.html#l00140">usb_task_init()</a>.
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Fri Jan 26 10:50:09 2007 for Atmel by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
