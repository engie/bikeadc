<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Atmel: USB device task module</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<h1>USB device task module</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00085.html#g7c2af30a7a3db221358b9f016ceb1375">usb_device_task_init</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function initializes the USB device controller.  <a href="#g7c2af30a7a3db221358b9f016ceb1375"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00085.html#g3384a2b4d7c3cf2702b11ec8aaa39223">usb_start_device</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function initializes the USB device controller.  <a href="#g3384a2b4d7c3cf2702b11ec8aaa39223"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00085.html#gf07e4fe32a964ffd5b36724976e7c7bd">usb_device_task</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Entry point of the USB device mamagement.  <a href="#gf07e4fe32a964ffd5b36724976e7c7bd"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="g7c2af30a7a3db221358b9f016ceb1375"></a><!-- doxytag: member="usb_device_task.h::usb_device_task_init" ref="g7c2af30a7a3db221358b9f016ceb1375" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_device_task_init           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function initializes the USB device controller. 
<p>
This function enables the USB controller and init the USB interrupts. The aim is to allow the USB connection detection in order to send the appropriate USB event to the operating mode manager.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>none</dd></dl>
/ 
<p>
Definition at line <a class="el" href="a00118.html#l00073">73</a> of file <a class="el" href="a00118.html">usb_device_task.c</a>.
<p>
References <a class="el" href="a00121.html#l00181">Usb_disable</a>, <a class="el" href="a00121.html#l00179">Usb_enable</a>, <a class="el" href="a00121.html#l00205">Usb_enable_vbus_interrupt</a>, <a class="el" href="a00121.html#l00176">Usb_low_speed_mode</a>, and <a class="el" href="a00121.html#l00189">Usb_select_device</a>.
<p>
Referenced by <a class="el" href="a00128.html#l00140">usb_task_init()</a>.<div class="fragment"><pre class="fragment"><a name="l00074"></a>00074 {
<a name="l00075"></a>00075    Enable_interrupt();
<a name="l00076"></a>00076    <a class="code" href="a00080.html#gb1c7cd82bc66fb726c9ebc86b96db2d2">Usb_disable</a>();
<a name="l00077"></a>00077    <a class="code" href="a00080.html#g002d3da52f4cf2f8f736b9dd1804cdd2">Usb_enable</a>();
<a name="l00078"></a>00078    <a class="code" href="a00080.html#g245fd526c891a777189340a0b60b0305">Usb_select_device</a>();
<a name="l00079"></a>00079 <span class="preprocessor">#if (USB_LOW_SPEED_DEVICE==ENABLE)</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>   <a class="code" href="a00080.html#gd29cc5d0a2d7bb7897499bec370c16b1">Usb_low_speed_mode</a>();
<a name="l00081"></a>00081 <span class="preprocessor">#endif</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>   <a class="code" href="a00080.html#g024eadfe8abcb924f346cb0ed1d5d846">Usb_enable_vbus_interrupt</a>();
<a name="l00083"></a>00083    Enable_interrupt();
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="g3384a2b4d7c3cf2702b11ec8aaa39223"></a><!-- doxytag: member="usb_device_task.h::usb_start_device" ref="g3384a2b4d7c3cf2702b11ec8aaa39223" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_start_device           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function initializes the USB device controller. 
<p>
This function enables the USB controller and init the USB interrupts. The aim is to allow the USB connection detection in order to send the appropriate USB event to the operating mode manager. Start device function is executed once VBUS connection has been detected either by the VBUS change interrupt either by the VBUS high level<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>none </dd></dl>

<p>
Definition at line <a class="el" href="a00118.html#l00100">100</a> of file <a class="el" href="a00118.html">usb_device_task.c</a>.
<p>
References <a class="el" href="a00121.html#l00335">Usb_attach</a>, <a class="el" href="a00121.html#l00377">Usb_enable_reset_interrupt</a>, <a class="el" href="a00121.html#l00397">Usb_enable_suspend_interrupt</a>, <a class="el" href="a00120.html#l00183">usb_init_device()</a>, <a class="el" href="a00121.html#l00195">Usb_unfreeze_clock</a>, and <a class="el" href="a00100.html#l00049">Wait_pll_ready</a>.
<p>
Referenced by <a class="el" href="a00118.html#l00121">usb_device_task()</a>, and <a class="el" href="a00128.html#l00286">usb_general_interrupt()</a>.<div class="fragment"><pre class="fragment"><a name="l00101"></a>00101 {
<a name="l00102"></a>00102    Pll_start_auto();
<a name="l00103"></a>00103    <a class="code" href="a00075.html#gf8afae5562a37053c7a62ddda9fbf8b1">Wait_pll_ready</a>();
<a name="l00104"></a>00104    <a class="code" href="a00080.html#g8bf7d660725edf11bc4c59baae4b2090">Usb_unfreeze_clock</a>();
<a name="l00105"></a>00105    <a class="code" href="a00081.html#g51bab31f4a3455524d85528166c4d43e">Usb_enable_suspend_interrupt</a>();
<a name="l00106"></a>00106    <a class="code" href="a00081.html#gb1785329acf114fd5f1e2c88d7d0f1c2">Usb_enable_reset_interrupt</a>();
<a name="l00107"></a>00107    <a class="code" href="a00045.html#f03d76cb0a6201b1c1de6bc25bf6657e">usb_init_device</a>();         <span class="comment">// configure the USB controller EP0</span>
<a name="l00108"></a>00108    <a class="code" href="a00081.html#g8b4883ed7eb31838167ff67c74a20647">Usb_attach</a>();
<a name="l00109"></a>00109 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="a00085_g3384a2b4d7c3cf2702b11ec8aaa39223_cgraph.png" border="0" usemap="#a00085_g3384a2b4d7c3cf2702b11ec8aaa39223_cgraph_map" alt=""></center>
<map name="a00085_g3384a2b4d7c3cf2702b11ec8aaa39223_cgraph_map">
<area href="a00045.html#f03d76cb0a6201b1c1de6bc25bf6657e" shape="rect" coords="177,5,289,32" alt="">
</map>

</div>
</div><p>
<a class="anchor" name="gf07e4fe32a964ffd5b36724976e7c7bd"></a><!-- doxytag: member="usb_device_task.h::usb_device_task" ref="gf07e4fe32a964ffd5b36724976e7c7bd" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_device_task           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Entry point of the USB device mamagement. 
<p>
This function is the entry point of the USB management. Each USB event is checked here in order to launch the appropriate action. If a Setup request occurs on the Default Control Endpoint, the <a class="el" href="a00086.html#g3a56939c3d898bcbbc8208297dccfe93">usb_process_request()</a> function is call in the <a class="el" href="a00051.html">usb_standard_request.c</a> file<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>none </dd></dl>

<p>
Definition at line <a class="el" href="a00118.html#l00121">121</a> of file <a class="el" href="a00118.html">usb_device_task.c</a>.
<p>
References <a class="el" href="a00121.html#l00032">EP_CONTROL</a>, <a class="el" href="a00129.html#l00046">EVT_USB_RESET</a>, <a class="el" href="a00093.html#l00226">FALSE</a>, <a class="el" href="a00129.html#l00033">Is_usb_event</a>, <a class="el" href="a00121.html#l00514">Is_usb_receive_setup</a>, <a class="el" href="a00121.html#l00208">Is_usb_vbus_high</a>, <a class="el" href="a00093.html#l00227">TRUE</a>, <a class="el" href="a00129.html#l00031">Usb_ack_event</a>, <a class="el" href="a00126.html#l00070">usb_configuration_nb</a>, <a class="el" href="a00118.html#l00046">usb_connected</a>, <a class="el" href="a00126.html#l00095">usb_process_request()</a>, <a class="el" href="a00121.html#l00432">Usb_reset_endpoint</a>, <a class="el" href="a00121.html#l00426">Usb_select_endpoint</a>, <a class="el" href="a00118.html#l00100">usb_start_device()</a>, and <a class="el" href="a00095.html#l00166">Usb_vbus_on_action</a>.
<p>
Referenced by <a class="el" href="a00128.html#l00199">usb_task()</a>.<div class="fragment"><pre class="fragment"><a name="l00122"></a>00122 {
<a name="l00123"></a>00123    <span class="keywordflow">if</span> (<a class="code" href="a00080.html#gf579eb0fe6dd1bf96e18b70399a52990">Is_usb_vbus_high</a>()&amp;&amp; <a class="code" href="a00043.html#23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a>==<a class="code" href="a00017.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00124"></a>00124    {
<a name="l00125"></a>00125       <a class="code" href="a00043.html#23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a> = <a class="code" href="a00017.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00126"></a>00126       <a class="code" href="a00085.html#g3384a2b4d7c3cf2702b11ec8aaa39223">usb_start_device</a>();
<a name="l00127"></a>00127       <a class="code" href="a00062.html#g14458cb2f309214b7263228a2a3dea9d">Usb_vbus_on_action</a>();
<a name="l00128"></a>00128    }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130    <span class="keywordflow">if</span>(<a class="code" href="a00088.html#g7c9320480ef6ad04fa7ecc5fbe46794d">Is_usb_event</a>(<a class="code" href="a00088.html#gc28579335a8f21ae1dcef6d69fbb1359">EVT_USB_RESET</a>))
<a name="l00131"></a>00131    {
<a name="l00132"></a>00132       <a class="code" href="a00088.html#g41da8b1e05449acf720091b1cab8cb3f">Usb_ack_event</a>(<a class="code" href="a00088.html#gc28579335a8f21ae1dcef6d69fbb1359">EVT_USB_RESET</a>);
<a name="l00133"></a>00133       <a class="code" href="a00082.html#ga2bbb2260917e717429cc68d0836a5d7">Usb_reset_endpoint</a>(0);
<a name="l00134"></a>00134       <a class="code" href="a00043.html#17e7aa663c771d6bddfea612365b55ee">usb_configuration_nb</a>=0;
<a name="l00135"></a>00135    }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137    <span class="comment">// Here connection to the device enumeration process</span>
<a name="l00138"></a>00138    <a class="code" href="a00082.html#gaeb7643aee75a875fb6c51f81afbaf53">Usb_select_endpoint</a>(<a class="code" href="a00077.html#g60c0c84fbef56ee0649395ebb54ada9c">EP_CONTROL</a>);
<a name="l00139"></a>00139    <span class="keywordflow">if</span> (<a class="code" href="a00082.html#g2ac1b36595ca868b2254c070b41f52bc">Is_usb_receive_setup</a>())
<a name="l00140"></a>00140    {
<a name="l00141"></a>00141       <a class="code" href="a00086.html#g3a56939c3d898bcbbc8208297dccfe93">usb_process_request</a>();
<a name="l00142"></a>00142    }
<a name="l00143"></a>00143 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="a00085_gf07e4fe32a964ffd5b36724976e7c7bd_cgraph.png" border="0" usemap="#a00085_gf07e4fe32a964ffd5b36724976e7c7bd_cgraph_map" alt=""></center>
<map name="a00085_gf07e4fe32a964ffd5b36724976e7c7bd_cgraph_map">
<area href="a00086.html#g3a56939c3d898bcbbc8208297dccfe93" shape="rect" coords="176,259,326,285" alt="">
<area href="a00085.html#g3384a2b4d7c3cf2702b11ec8aaa39223" shape="rect" coords="190,411,312,437" alt="">
<area href="a00051.html#67506404dfea6b29e80cf82bdaea6f22" shape="rect" coords="391,5,519,32" alt="">
<area href="a00051.html#e92ef962c797a8ef223beaa22f3f020a" shape="rect" coords="379,56,531,83" alt="">
<area href="a00051.html#7e07097353481f6d588e8a94f2a2801a" shape="rect" coords="387,107,523,133" alt="">
<area href="a00051.html#42fe778205062c934e4f66abdf63d0ad" shape="rect" coords="391,157,519,184" alt="">
<area href="a00051.html#774479a31f2ffee5cea7968a26ae6064" shape="rect" coords="399,208,511,235" alt="">
<area href="a00051.html#679a1cae6c591cd1083ca444b0c0bd4f" shape="rect" coords="394,259,516,285" alt="">
<area href="a00051.html#f773b5ab99ae3cf3c22b046a49433193" shape="rect" coords="379,309,531,336" alt="">
<area href="a00051.html#9dc9b1584d7841fda822aa46298186f6" shape="rect" coords="396,360,514,387" alt="">
<area href="a00051.html#d924ab761ffddfe9c57f4708af825882" shape="rect" coords="391,411,519,437" alt="">
<area href="a00049.html#d561daf187c11aa8679aa559ac13e322" shape="rect" coords="374,461,536,488" alt="">
<area href="a00049.html#4c69acf3759419bc80ee97e520bc2a1e" shape="rect" coords="591,107,759,133" alt="">
<area href="a00049.html#b5961b9c9678ef0040178b3ae648868b" shape="rect" coords="595,309,755,336" alt="">
<area href="a00049.html#3c9ce9f7e3557533d433271faa51d801" shape="rect" coords="604,411,746,437" alt="">
<area href="a00049.html#76d48e14fef77a55e8a4b9bbd954ba1f" shape="rect" coords="586,461,764,488" alt="">
<area href="a00049.html#307c50826a5545b1b887616f8336d33f" shape="rect" coords="604,512,746,539" alt="">
<area href="a00045.html#f03d76cb0a6201b1c1de6bc25bf6657e" shape="rect" coords="399,512,511,539" alt="">
</map>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Fri Jan 26 10:50:11 2007 for Atmel by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
